import{n as $,m as f,r as T,a0 as j,o as N,x as D,w as l,b as S,H as P,d as o,v as a,e as v,W as q,X as A,ae as G,D as le,a6 as O,c as ae,ah as re,a9 as h,Y as se,E as de}from"./index-87dc6a3d.js";import{E as ne}from"./el-select-a16e320c.js";import{E as H,a as R}from"./el-input-feb6af59.js";import{c as ie,d as ge}from"./el-scrollbar-10e2dddd.js";/* empty css                 */import{E as ue,a as me,b as pe}from"./el-table-column-d69f2288.js";import{E as ce}from"./el-popover-ffc4f456.js";/* empty css                          *//* empty css                */import{E as fe}from"./el-image-viewer-b78ccc76.js";import{u as W,a as we,E as ve,b as _e}from"./useCategoryStore-f901f982.js";import{E as Ce}from"./el-overlay-e8d2bcca.js";import{a as ye,E as be}from"./el-form-item-9887e1f6.js";import{E as Ie}from"./el-switch-f1422462.js";import{_ as Se}from"./UploadBox-ae10d77b.js";import"./strings-31cb2fe7.js";import"./goodsApi-e52c28cf.js";const xe={__name:"GoodsDrawer",props:{drawer:{type:Boolean,default(){return!1}},ifEdit:{type:Boolean,default(){return!1}},goods:{type:Object}},emits:["update:drawer"],setup(F,{emit:u}){const d=F,b=W(),x=we(),m=$({get(){return d.drawer},set(g){u("update:drawer",g)}});x.getCategoryList();const w=f(),I=f();let e=T({});j(()=>{d.ifEdit?(e.goodsCategoryId=d.goods.goodsCategoryId,e.goodsCoverImg=d.goods.goodsCoverImg,e.goodsDetailContent=d.goods.goodsDetailContent,e.goodsIntro=d.goods.goodsIntro,e.goodsName=d.goods.goodsName,e.goodsSellStatus=!d.goods.goodsSellStatus,e.originalPrice=d.goods.originalPrice,e.sellingPrice=d.goods.sellingPrice,e.stockNum=d.goods.stockNum,e.tag=d.goods.tag,e.goodsId=d.goods.goodsId):(e.goodsCategoryId="",e.goodsCoverImg="",e.goodsDetailContent="",e.goodsIntro="",e.goodsName="",e.goodsSellStatus=!0,e.originalPrice="",e.sellingPrice="",e.stockNum="",e.tag="",e.goodsId="")});const U=T({goodsCategoryId:[{required:!0,message:"请指定类别",trigger:"blur"}],goodsCoverImg:[{required:!0,message:"请上传图片",trigger:"blur"}],goodsDetailContent:[{required:!0,message:"请输入详情",trigger:"blur"}],goodsIntro:[{required:!0,message:"请输入简介",trigger:"blur"}],goodsName:[{required:!0,message:"请设置商品名称",trigger:"blur"}],originalPrice:[{required:!0,message:"请设置价格",trigger:"blur"}],sellingPrice:[{required:!0,message:"请设置价格",trigger:"blur"}],stockNum:[{required:!0,message:"请设置库存",trigger:"blur"}],tag:[{required:!0,message:"请设置关键字",trigger:"blur"}]}),z=g=>{console.log("新增"),g&&g.validate(async t=>{if(t)await b.getGoodAdd({goodsCategoryId:e.goodsCategoryId instanceof Array?e.goodsCategoryId[2]:e.goodsCategoryId,goodsCoverImg:e.goodsCoverImg.replace("http://192.168.1.3:28019",""),goodsDetailContent:e.goodsDetailContent,goodsIntro:e.goodsIntro,goodsName:e.goodsName,goodsSellStatus:e.goodsSellStatus?"0":"1",originalPrice:e.originalPrice,sellingPrice:e.sellingPrice,stockNum:e.stockNum,tag:e.tag}),console.log(g),k(g),I.value.clear();else return console.log("error submit!"),!1})},B=g=>{console.log("修改"),g&&g.validate(async t=>{if(t)await b.getGoodEdit({goodsCategoryId:e.goodsCategoryId instanceof Array?e.goodsCategoryId[2]:e.goodsCategoryId,goodsCoverImg:e.goodsCoverImg.replace("http://192.168.1.3:28019",""),goodsDetailContent:e.goodsDetailContent,goodsIntro:e.goodsIntro,goodsName:e.goodsName,goodsSellStatus:e.goodsSellStatus?"0":"1",originalPrice:e.originalPrice,sellingPrice:e.sellingPrice,stockNum:e.stockNum,tag:e.tag,goodsId:e.goodsId}),console.log(g),k(g),I.value.clear(),u("update:drawer",!1);else return console.log("error submit!"),!1})},k=g=>{g&&g.resetFields()};return(g,t)=>{const _=ve,p=ye,C=H,V=Ie,E=_e,r=R,s=be,y=Ce;return N(),D(y,{modelValue:a(m),"onUpdate:modelValue":t[13]||(t[13]=n=>G(m)?m.value=n:null),direction:"rtl","lock-scroll":!1,size:"50%","destroy-on-close":""},{header:l(()=>[S("h4",null,P(`${d.ifEdit?"编辑":"新增"}商品信息`),1)]),default:l(()=>[o(s,{ref_key:"ruleFormRef",ref:w,model:a(e),"status-icon":"",rules:a(U),"label-width":"80px",class:"demo-ruleForm"},{default:l(()=>[o(p,{label:"分类",prop:"goodsCategoryId"},{default:l(()=>[o(_,{modelValue:a(e).goodsCategoryId,"onUpdate:modelValue":t[0]||(t[0]=n=>a(e).goodsCategoryId=n),options:a(x).categoryList,props:{expandTrigger:"click"},"show-all-levels":!1},null,8,["modelValue","options"])]),_:1}),o(p,{label:"上传图片",prop:"goodsCoverImg"},{default:l(()=>[o(Se,{ref_key:"upload",ref:I,modelValue:a(e).goodsCoverImg,"onUpdate:modelValue":[t[1]||(t[1]=n=>a(e).goodsCoverImg=n),t[2]||(t[2]=n=>a(e).goodsCoverImg=n)]},null,8,["modelValue"])]),_:1}),o(p,{label:"详情",prop:"goodsDetailContent"},{default:l(()=>[o(C,{modelValue:a(e).goodsDetailContent,"onUpdate:modelValue":t[3]||(t[3]=n=>a(e).goodsDetailContent=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(p,{label:"简介",prop:"goodsIntro"},{default:l(()=>[o(C,{modelValue:a(e).goodsIntro,"onUpdate:modelValue":t[4]||(t[4]=n=>a(e).goodsIntro=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(p,{label:"商品名称",prop:"goodsName"},{default:l(()=>[o(C,{modelValue:a(e).goodsName,"onUpdate:modelValue":t[5]||(t[5]=n=>a(e).goodsName=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(p,{prop:"goodsSellStatus"},{default:l(()=>[o(V,{modelValue:a(e).goodsSellStatus,"onUpdate:modelValue":t[6]||(t[6]=n=>a(e).goodsSellStatus=n),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"现在上架","inactive-text":"暂不上架"},null,8,["modelValue"])]),_:1}),o(p,{label:"原价",prop:"originalPrice"},{default:l(()=>[o(C,{modelValue:a(e).originalPrice,"onUpdate:modelValue":t[7]||(t[7]=n=>a(e).originalPrice=n),modelModifiers:{number:!0},autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(p,{label:"现价",prop:"sellingPrice"},{default:l(()=>[o(C,{modelValue:a(e).sellingPrice,"onUpdate:modelValue":t[8]||(t[8]=n=>a(e).sellingPrice=n),modelModifiers:{number:!0},autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(p,{label:"库存",prop:"stockNum"},{default:l(()=>[o(E,{modelValue:a(e).stockNum,"onUpdate:modelValue":t[9]||(t[9]=n=>a(e).stockNum=n),min:1},null,8,["modelValue"])]),_:1}),o(p,{label:"关键词",prop:"tag"},{default:l(()=>[o(C,{modelValue:a(e).tag,"onUpdate:modelValue":t[10]||(t[10]=n=>a(e).tag=n),modelModifiers:{number:!0},autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(p,null,{default:l(()=>[o(r,{type:"primary",onClick:t[11]||(t[11]=n=>d.ifEdit?B(w.value):z(w.value))},{default:l(()=>[v("提交")]),_:1}),q(o(r,{onClick:t[12]||(t[12]=n=>k(w.value))},{default:l(()=>[v("重置")]),_:1},512),[[A,!d.ifEdit]])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}};const ke={class:"row1"},Ve=S("span",null,"订单状态",-1),Ee={class:"row3"},He={__name:"EditPage",setup(F){const u=W();let d=f(),b=f();le(()=>{d.value,b.value=window.getComputedStyle(d.value).height}),window.onresize=()=>{let r=0,s=0;window.getComputedStyle(d.value).boxSizing=="border-box"&&(r=window.getComputedStyle(d.value).paddingTop?window.getComputedStyle(d.value).paddingTop.replace("px",""):0,s=window.getComputedStyle(d.value).paddingBottom?window.getComputedStyle(d.value).paddingBottom.replace("px",""):0),b.value=`${window.getComputedStyle(d.value).height.replace("px","")-r-s}px`,console.log(window.getComputedStyle(d.value).height,r,s,b.value)};const x=f(),m=f(!1),w=f(!1),I=f();let e=T({});const U=()=>{w.value=!0,I.value=!1},z=r=>{w.value=!0,I.value=!0,e.goodsCategoryId=r.row.goodsCategoryId,e.goodsCoverImg=r.row.goodsCoverImg,e.goodsDetailContent=r.row.goodsDetailContent,e.goodsIntro=r.row.goodsIntro,e.goodsName=r.row.goodsName,e.goodsSellStatus=r.row.goodsSellStatus,e.originalPrice=r.row.originalPrice,e.sellingPrice=r.row.sellingPrice,e.stockNum=r.row.stockNum,e.tag=r.row.tag,e.goodsId=r.row.goodsId},B=r=>{u.getGoodsToggle(r.row.goodsSellStatus?0:1,{ids:[r.row.goodsId]})},k=r=>{m.value&&x.value.getSelectionRows().length&&u.getGoodsToggle(r,{ids:x.value.getSelectionRows().map(s=>s.goodsId)}),m.value=!m.value},g=f(),t=f(),_=f(!1),p=()=>{u.goodsFilter=g.value},C=()=>{u.goodsSellStatus=t.value[0],_.value=!1},V=$({get(){return u.goodsPage},set(r){u.goodsPage=r}}),E=$({get(){return u.goodsSize},set(r){u.goodsSize=r}});return j(async()=>{await u.getGoodsList(V.value,E.value,u.goodsFilter,u.goodsSellStatus)}),(r,s)=>{const y=R,n=H,c=ue,X=fe,Y=O("ArrowDownBold"),M=de,J=O("ArrowUpBold"),L=ie,K=ge,Q=ce,Z=me,ee=pe,oe=ne;return N(),ae(se,null,[S("div",ke,[o(y,{onClick:U,type:"primary"},{default:l(()=>[v("新增")]),_:1}),o(y,{onClick:s[0]||(s[0]=i=>m.value=!m.value),type:"default"},{default:l(()=>[v(P(m.value?"取消批量操作":"批量操作"),1)]),_:1}),q(o(y,{onClick:s[1]||(s[1]=i=>k(0)),type:"success"},{default:l(()=>[v(P("上架"))]),_:1},512),[[A,m.value]]),q(o(y,{onClick:s[2]||(s[2]=i=>k(1)),type:"danger"},{default:l(()=>[v(P("下架"))]),_:1},512),[[A,m.value]]),o(n,{modelValue:g.value,"onUpdate:modelValue":s[3]||(s[3]=i=>g.value=i),placeholder:"搜索现有商品","prefix-icon":a(re),onChange:p,style:{width:"200px","margin-left":"10px"}},null,8,["modelValue","prefix-icon"])]),S("div",{ref_key:"tableContainerRef",ref:d,class:"row2"},[o(ee,{ref_key:"multipleTableRef",ref:x,stripe:"",border:"",height:a(b),style:{width:"100%","text-align":"center"},data:a(u).goodsList,"row-key":"goodsId"},{empty:l(()=>[o(Z,{description:"加载中"})]),default:l(()=>[m.value?(N(),D(c,{key:0,type:"selection","min-width":"55px","reserve-selection":"",fixed:""})):h("",!0),o(c,{type:"index","min-width":"55px",label:"序号",fixed:""}),o(c,{label:"ID","min-width":"70px",property:"goodsId"}),o(c,{label:"封面图片","min-width":"140px"},{default:l(i=>[o(X,{style:{width:"100px",height:"100px"},src:`http://192.168.1.3:28019${i.row.goodsCoverImg}`,fit:"contain","hide-on-click-modal":!0,lazy:"","preview-src-list":[`http://192.168.1.3:28019${i.row.goodsCoverImg}`]},null,8,["src","preview-src-list"])]),_:1}),h("",!0),o(c,{property:"goodsName",label:"标题","min-width":"150px","show-overflow-tooltip":""}),o(c,{property:"goodsIntro",label:"描述","min-width":"250px","show-overflow-tooltip":""}),o(c,{property:"originalPrice",label:"原价","min-width":"80px","show-overflow-tooltip":"",sortable:""}),o(c,{property:"sellingPrice",label:"现价","min-width":"80px","show-overflow-tooltip":"",sortable:""}),o(c,{property:"stockNum",label:"库存","min-width":"70px","show-overflow-tooltip":""}),o(c,{property:"tag",label:"关键词","min-width":"120px","show-overflow-tooltip":""}),o(c,{label:"状态","min-width":"120px","show-overflow-tooltip":""},{header:l(()=>[o(Q,{placement:"bottom-end",width:100,visible:_.value},{reference:l(()=>[S("div",{style:{cursor:"pointer"},onClick:s[4]||(s[4]=i=>_.value=!_.value)},[Ve,_.value?h("",!0):(N(),D(M,{key:0,size:"16px"},{default:l(()=>[o(Y)]),_:1})),_.value?(N(),D(M,{key:1,size:"16px"},{default:l(()=>[o(J)]),_:1})):h("",!0)])]),default:l(()=>[o(K,{modelValue:t.value,"onUpdate:modelValue":s[5]||(s[5]=i=>t.value=i),max:1,onChange:C},{default:l(()=>[o(L,{label:"1"},{default:l(()=>[v("已下架")]),_:1}),o(L,{label:"0"},{default:l(()=>[v("上架中")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["visible"])]),default:l(i=>[S("span",null,P(i.row.goodsSellStatus?"已下架":"上架中"),1)]),_:1}),o(c,{label:"操作",fixed:"right","min-width":"150px"},{default:l(i=>[o(y,{disabled:!!m.value,size:"default",onClick:te=>z(i)},{default:l(()=>[v("编辑")]),_:2},1032,["disabled","onClick"]),o(y,{disabled:!!m.value,size:"default",type:i.row.goodsSellStatus?"success":"danger",onClick:te=>B(i),style:{margin:"12px 0"}},{default:l(()=>[v(P(i.row.goodsSellStatus?"上架":"下架"),1)]),_:2},1032,["disabled","type","onClick"])]),_:1})]),_:1},8,["height","data"])],512),S("div",Ee,[o(oe,{currentPage:a(V),"onUpdate:currentPage":s[6]||(s[6]=i=>G(V)?V.value=i:null),pageSize:a(E),"onUpdate:pageSize":s[7]||(s[7]=i=>G(E)?E.value=i:null),"page-sizes":[10,15,20],layout:"total, sizes, prev, pager, next, jumper",total:a(u).goodsCount,"page-count":a(u).goodstotalPage},null,8,["currentPage","pageSize","total","page-count"])]),o(xe,{drawer:w.value,"onUpdate:drawer":s[8]||(s[8]=i=>w.value=i),"onUpdata:drawer":s[9]||(s[9]=i=>w.value=i),ifEdit:I.value,goods:a(e)},null,8,["drawer","ifEdit","goods"])],64)}}};export{He as default};
