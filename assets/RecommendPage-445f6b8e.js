import{n as S,m as w,a0 as F,r as L,o as z,x as O,w as l,b as y,H as C,d as e,v as r,ah as ee,ae as V,c as H,Y as M,ag as te,e as k,W as oe,X as le,D as ae,a9 as ne}from"./index-87dc6a3d.js";import{E as A,a as re,b as de,c as se}from"./el-select-a16e320c.js";import{E as ie,a as G}from"./el-input-feb6af59.js";import{b as ue}from"./el-scrollbar-10e2dddd.js";/* empty css                 */import{E as pe,a as ce,b as ge}from"./el-table-column-d69f2288.js";import{a as W,b as X,E as Y}from"./el-col-cf38a599.js";import{E as J}from"./el-image-viewer-b78ccc76.js";import{u as K}from"./useHomeStore-e26e6c72.js";import{E as me}from"./el-overlay-e8d2bcca.js";import{a as fe,E as _e}from"./el-form-item-9887e1f6.js";import"./strings-31cb2fe7.js";import"./goodsApi-e52c28cf.js";const we={style:{width:"100%","font-weight":"800","text-align":"center",flex:"1",display:"flex","flex-flow":"row wrap","white-space":"pre-wrap","line-height":"15px"}},ye={style:{width:"100%",flex:"1","white-space":"pre-wrap","flex-flow":"row wrap","line-height":"15px"}},xe={__name:"RecommendDrawer",props:{drawer:{type:Boolean,default(){return!1}},ifEdit:{type:Boolean,default(){return!1}},recommend:{type:Object}},emits:["update:drawer"],setup(q,{emit:u}){const d=q,s=K(),x=S({get(){return d.drawer},set(t){u("update:drawer",t)}}),p=w(),v=()=>{s.goodsFilter=p.value},m=S({get(){return s.goodsPage},set(t){s.goodsPage=t}}),h=S({get(){return s.goodsSize},set(t){s.goodsSize=t}});F(async()=>{await s.getGoodsList(m.value,h.value,p.value,0)});const b=w();let n=L({});F(()=>{d.ifEdit?(n.configRank=d.recommend.configRank,n.goodsId=d.recommend.goodsId,n.configName=d.recommend.configName,n.configId=d.recommend.configId):(n.configRank="",n.goodsId="",n.configName="",n.configId="")});const P=L({configRank:[{required:!0,message:"请设置权重等级",trigger:"blur"}],goodsId:[{required:!0,message:"请选择商品",trigger:"blur"}],configName:[{required:!0,message:"请设置推荐名称",trigger:"blur"}]}),D=t=>{console.log("新增"),t&&t.validate(async o=>{if(o)await s.getRecommendAdd({configRank:n.configRank,goodsId:n.goodsId,configName:n.configName}),console.log(t),f(t);else return console.log("error submit!"),!1})},E=t=>{console.log("修改"),t&&t.validate(async o=>{if(o)await s.getRecommendEdit({configRank:n.configRank,goodsId:n.goodsId,configName:n.configName,configId:n.configId}),console.log(t),f(t),u("update:drawer",!1);else return console.log("error submit!"),!1})},f=t=>{t&&(t.resetFields(),s.$patch({goodsFilter:""}))};return(t,o)=>{const _=ie,c=fe,$=A,N=J,I=W,B=X,U=Y,T=re,j=ue,i=de,g=se,R=G,Q=_e,Z=me;return z(),O(Z,{modelValue:r(x),"onUpdate:modelValue":o[7]||(o[7]=a=>V(x)?x.value=a:null),direction:"rtl","lock-scroll":!1,size:"50%","destroy-on-close":""},{header:l(()=>[y("h4",null,C(`${d.ifEdit?"编辑":"新增"}推荐商品配置`),1)]),default:l(()=>[e(Q,{ref_key:"ruleFormRef",ref:b,model:r(n),"status-icon":"",rules:r(P),"label-width":"80px",class:"demo-ruleForm"},{default:l(()=>[e(c,{label:"展示权重",prop:"configRank"},{default:l(()=>[e(_,{modelValue:r(n).configRank,"onUpdate:modelValue":o[0]||(o[0]=a=>r(n).configRank=a),modelModifiers:{number:!0},autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(c,{label:"选择商品",prop:"goodsId"},{default:l(()=>[e(g,{modelValue:r(n).goodsId,"onUpdate:modelValue":o[3]||(o[3]=a=>r(n).goodsId=a),class:"m-2",placeholder:"请选择商品",size:"large","validate-event":!1,"popper-append-to-body":!1},{default:l(()=>[e(i,null,{default:l(()=>[e(_,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=a=>p.value=a),class:"w-50 m-2",placeholder:"搜索现有商品","prefix-icon":r(ee),onChange:v,style:{width:"80%","margin-left":"30px","margin-bottom":"20px"}},null,8,["modelValue","prefix-icon"]),e($,{currentPage:r(m),"onUpdate:currentPage":o[2]||(o[2]=a=>V(m)?m.value=a:null),small:"",layout:"total, prev, pager, next, jumper",total:r(s).goodsCount,"page-count":r(s).goodstotalPage,style:{margin:"0 20px"}},null,8,["currentPage","total","page-count"]),e(j,null,{default:l(()=>[(z(!0),H(M,null,te(r(s).goodsList,a=>(z(),O(T,{key:a.goodsId,label:a.label,value:a.goodsId,style:{height:"170px"}},{default:l(()=>[e(U,{"body-style":{padding:"10px",width:"300px",height:"140px"},style:{width:"300px",height:"140px",margin:"14px",padding:"0",display:"flex","justify-content":"center"}},{default:l(()=>[e(B,{style:{flex:"1"}},{default:l(()=>[e(I,{span:8,style:{display:"flex","justify-content":"center","align-items":"center"}},{default:l(()=>[e(N,{src:`http://192.168.1.3:28019${a==null?void 0:a.goodsCoverImg}`,style:{width:"100px",height:"120px"},fit:"contain","hide-on-click-modal":!0,lazy:""},null,8,["src"])]),_:2},1024),e(I,{span:16,style:{display:"flex","flex-flow":"column","align-items":"center","font-size":"14px",padding:"5px"}},{default:l(()=>[y("span",we,C(a==null?void 0:a.goodsName),1),y("span",ye,C(a==null?void 0:a.goodsIntro),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label","value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"推荐名称",prop:"configName"},{default:l(()=>[e(_,{modelValue:r(n).configName,"onUpdate:modelValue":o[4]||(o[4]=a=>r(n).configName=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(c,null,{default:l(()=>[e(R,{type:"primary",onClick:o[5]||(o[5]=a=>d.ifEdit?E(b.value):D(b.value))},{default:l(()=>[k("提交")]),_:1}),oe(e(R,{onClick:o[6]||(o[6]=a=>f(b.value))},{default:l(()=>[k("重置")]),_:1},512),[[le,!d.ifEdit]])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}};const ve={class:"row1"},he={style:{"font-weight":"800","text-align":"center"}},be={style:{"text-align":"center"}},Ee={class:"row3"},Te={__name:"RecommendPage",setup(q){const u=K();let d=w(),s=w();ae(()=>{d.value,s.value=window.getComputedStyle(d.value).height}),window.onresize=()=>{let t=0,o=0;window.getComputedStyle(d.value).boxSizing=="border-box"&&(t=window.getComputedStyle(d.value).paddingTop?window.getComputedStyle(d.value).paddingTop.replace("px",""):0,o=window.getComputedStyle(d.value).paddingBottom?window.getComputedStyle(d.value).paddingBottom.replace("px",""):0),s.value=`${window.getComputedStyle(d.value).height.replace("px","")-t-o}px`,console.log(window.getComputedStyle(d.value).height,t,o,s.value)};const x=w(),p=w(!1),v=w(!1),m=w();let h=L({});const b=()=>{v.value=!0,m.value=!1},n=t=>{v.value=!0,m.value=!0,h.goodsId=t.row.goodsId,h.configRank=t.row.configRank,h.configName=t.row.configName,h.configId=t.row.configId},P=t=>{u.getRecommendDelete({ids:[t.row.configId]})},D=()=>{p.value&&x.value.getSelectionRows().length&&u.getRecommendDelete({ids:x.value.getSelectionRows().map(t=>t.configId)}),p.value=!p.value},E=S({get(){return u.currPage},set(t){u.currPage=t}}),f=S({get(){return u.pageSize},set(t){u.pageSize=t}});return F(async()=>{await u.getRecommendList(E.value,f.value)}),(t,o)=>{const _=G,c=pe,$=J,N=W,I=X,B=Y,U=ce,T=ge,j=A;return z(),H(M,null,[y("div",ve,[e(_,{onClick:b,type:"primary"},{default:l(()=>[k("新增")]),_:1}),e(_,{onClick:D,type:p.value?"danger":"default"},{default:l(()=>[k(C(p.value?"批量删除/取消批量操作":"批量操作"),1)]),_:1},8,["type"])]),y("div",{ref_key:"tableContainerRef",ref:d,class:"row2"},[e(T,{ref_key:"multipleTableRef",ref:x,stripe:"",border:"",height:r(s),style:{width:"100%","text-align":"center"},data:r(u).recommendList,"row-key":"configId"},{empty:l(()=>[e(U,{description:"加载中"})]),default:l(()=>[p.value?(z(),O(c,{key:0,type:"selection","min-width":"55px","reserve-selection":"",fixed:""})):ne("",!0),e(c,{type:"index","min-width":"70px",label:"序号"}),e(c,{label:"ID","min-width":"70px",property:"configId"}),e(c,{label:"推荐名称","min-width":"100px",property:"configName"}),e(c,{label:"商品展示","min-width":"320px"},{default:l(i=>[e(B,{"body-style":{padding:"10px"},style:{width:"300px",height:"140px",padding:"0",display:"flex","justify-content":"center"}},{default:l(()=>[e(I,{style:{flex:"1"}},{default:l(()=>[e(N,{span:8,style:{display:"flex","justify-content":"center","align-items":"center"}},{default:l(()=>{var g,R;return[e($,{src:`http://192.168.1.3:28019${(g=i.row.goodDetail)==null?void 0:g.goodsCoverImg}`,style:{width:"100px",height:"120px"},fit:"contain","hide-on-click-modal":!0,lazy:"","preview-src-list":[`http://192.168.1.3:28019${(R=i.row.goodDetail)==null?void 0:R.goodsCoverImg}`]},null,8,["src","preview-src-list"])]}),_:2},1024),e(N,{span:16,style:{display:"flex","flex-flow":"column","align-items":"center","font-size":"14px"}},{default:l(()=>[e(I,{gutter:10,style:{flex:"1","text-align":"center"}},{default:l(()=>{var g;return[y("span",he,C((g=i.row.goodDetail)==null?void 0:g.goodsName),1)]}),_:2},1024),e(I,{style:{flex:"1","text-align":"center"}},{default:l(()=>{var g;return[y("span",be,C((g=i.row.goodDetail)==null?void 0:g.goodsIntro),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),e(c,{property:"configRank",label:"展示权重","min-width":"120px","show-overflow-tooltip":"",sortable:""}),e(c,{label:"操作","min-width":"150px",fixed:"right"},{default:l(i=>[e(_,{disabled:!!p.value,size:"default",onClick:g=>n(i)},{default:l(()=>[k("编辑")]),_:2},1032,["disabled","onClick"]),e(_,{disabled:!!p.value,size:"default",type:"danger",onClick:g=>P(i),style:{margin:"12px 0"}},{default:l(()=>[k("删除")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["height","data"])],512),y("div",Ee,[e(j,{currentPage:r(E),"onUpdate:currentPage":o[0]||(o[0]=i=>V(E)?E.value=i:null),pageSize:r(f),"onUpdate:pageSize":o[1]||(o[1]=i=>V(f)?f.value=i:null),"page-sizes":[10,15,20],layout:"total, sizes, prev, pager, next, jumper",total:r(u).totalCount,"page-count":r(u).totalPage},null,8,["currentPage","pageSize","total","page-count"])]),e(xe,{drawer:v.value,"onUpdate:drawer":o[2]||(o[2]=i=>v.value=i),"onUpdata:drawer":o[3]||(o[3]=i=>v.value=i),ifEdit:m.value,recommend:r(h)},null,8,["drawer","ifEdit","recommend"])],64)}}};export{Te as default};
