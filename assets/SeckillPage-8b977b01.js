import{n as C,m as f,a0 as F,r as L,o as z,x as O,w as l,b as y,H as S,d as e,v as i,ah as Z,ae as R,c as H,Y as M,ag as ee,e as I,W as te,X as oe,a as le,D as ae,a9 as ne}from"./index-87dc6a3d.js";import{E as A,a as ie,b as se,c as re}from"./el-select-a16e320c.js";import{E as de,a as G}from"./el-input-feb6af59.js";import"./el-scrollbar-10e2dddd.js";/* empty css                 */import{E as ue,a as pe,b as ce}from"./el-table-column-d69f2288.js";import{a as W,b as X,E as Y}from"./el-col-cf38a599.js";import{E as J}from"./el-image-viewer-b78ccc76.js";import{u as K}from"./useHomeStore-e26e6c72.js";import{E as ge}from"./el-overlay-e8d2bcca.js";import{a as fe,E as me}from"./el-form-item-9887e1f6.js";import"./strings-31cb2fe7.js";import"./goodsApi-e52c28cf.js";const _e={style:{width:"100%","font-weight":"800","text-align":"center",flex:"1",display:"flex","flex-flow":"row wrap","white-space":"pre-wrap","line-height":"15px"}},we={style:{width:"100%",flex:"1","white-space":"pre-wrap","flex-flow":"row wrap","line-height":"15px"}},ye={__name:"SeckillDrawer",props:{drawer:{type:Boolean,default(){return!1}},ifEdit:{type:Boolean,default(){return!1}},seckill:{type:Object}},emits:["update:drawer"],setup(q,{emit:u}){const s=q,r=K(),x=C({get(){return s.drawer},set(t){u("update:drawer",t)}}),p=f();f(!1);const v=()=>{r.goodsFilter=p.value},m=C({get(){return r.goodsPage},set(t){r.goodsPage=t}}),h=C({get(){return r.goodsSize},set(t){r.goodsSize=t}});F(async()=>{await r.getGoodsList(m.value,h.value,p.value,0)});const k=f();let n=L({});F(()=>{s.ifEdit?(n.configRank=s.seckill.configRank,n.goodsId=s.seckill.goodsId,n.configName=s.seckill.configName,n.configId=s.seckill.configId):(n.configRank="",n.goodsId="",n.configName="",n.configId="")});const P=L({configRank:[{required:!0,message:"请设置权重等级",trigger:"blur"}],goodsId:[{required:!0,message:"请选择商品",trigger:"blur"}],configName:[{required:!0,message:"请设置秒杀名称",trigger:"blur"}]}),D=t=>{console.log("新增"),t&&t.validate(async o=>{if(o)await r.getSeckillAdd({configRank:n.configRank,goodsId:n.goodsId,configName:n.configName}),console.log(t),_(t);else return console.log("error submit!"),!1})},b=t=>{console.log("修改"),t&&t.validate(async o=>{if(o)await r.getSeckillEdit({configRank:n.configRank,goodsId:n.goodsId,configName:n.configName,configId:n.configId}),console.log(t),_(t),u("update:drawer",!1);else return console.log("error submit!"),!1})},_=t=>{t&&(t.resetFields(),r.$patch("goodsFilter",""))};return(t,o)=>{const w=de,g=fe,$=A,N=J,E=W,B=X,U=Y,T=ie,j=se,d=re,c=G,V=me,Q=ge;return z(),O(Q,{modelValue:i(x),"onUpdate:modelValue":o[7]||(o[7]=a=>R(x)?x.value=a:null),direction:"rtl","lock-scroll":!1,size:"50%","destroy-on-close":""},{header:l(()=>[y("h4",null,S(`${s.ifEdit?"编辑":"新增"}新品秒杀配置`),1)]),default:l(()=>[e(V,{ref_key:"ruleFormRef",ref:k,model:i(n),"status-icon":"",rules:i(P),"label-width":"80px",class:"demo-ruleForm"},{default:l(()=>[e(g,{label:"展示权重",prop:"configRank"},{default:l(()=>[e(w,{modelValue:i(n).configRank,"onUpdate:modelValue":o[0]||(o[0]=a=>i(n).configRank=a),modelModifiers:{number:!0},autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(g,{label:"选择商品",prop:"goodsId"},{default:l(()=>[e(d,{modelValue:i(n).goodsId,"onUpdate:modelValue":o[3]||(o[3]=a=>i(n).goodsId=a),class:"m-2",placeholder:"Select",size:"large","validate-event":!1},{default:l(()=>[e(j,{lable:"可筛选后进行选择"},{default:l(()=>[e(w,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=a=>p.value=a),class:"w-50 m-2",placeholder:"搜索现有商品","prefix-icon":i(Z),onChange:v,style:{width:"80%","margin-left":"30px"}},null,8,["modelValue","prefix-icon"]),e($,{currentPage:i(m),"onUpdate:currentPage":o[2]||(o[2]=a=>R(m)?m.value=a:null),small:"",layout:"total, prev, pager, next",total:i(r).goodsCount,"page-count":i(r).goodstotalPage,style:{margin:"0 20px"}},null,8,["currentPage","total","page-count"]),(z(!0),H(M,null,ee(i(r).goodsList,a=>(z(),O(T,{key:a.goodsId,label:a.label,value:a.goodsId,style:{height:"160px"}},{default:l(()=>[e(U,{"body-style":{padding:"10px",width:"300px",height:"140px"},style:{width:"300px",height:"140px",margin:"14px",padding:"0",display:"flex","justify-content":"center"}},{default:l(()=>[e(B,{style:{flex:"1"}},{default:l(()=>[e(E,{span:8,style:{display:"flex","justify-content":"center","align-items":"center"}},{default:l(()=>[e(N,{src:`http://192.168.1.3:28019${a==null?void 0:a.goodsCoverImg}`,style:{width:"100px",height:"120px"},fit:"contain","hide-on-click-modal":!0,lazy:""},null,8,["src"])]),_:2},1024),e(E,{span:16,style:{display:"flex","flex-flow":"column","align-items":"center","font-size":"14px",padding:"5px"}},{default:l(()=>[y("span",_e,S(a==null?void 0:a.goodsName),1),y("span",we,S(a==null?void 0:a.goodsIntro),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label","value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"秒杀名称",prop:"configName"},{default:l(()=>[e(w,{modelValue:i(n).configName,"onUpdate:modelValue":o[4]||(o[4]=a=>i(n).configName=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(g,null,{default:l(()=>[e(c,{type:"primary",onClick:o[5]||(o[5]=a=>s.ifEdit?b(k.value):D(k.value))},{default:l(()=>[I("提交")]),_:1}),te(e(c,{onClick:o[6]||(o[6]=a=>_(k.value))},{default:l(()=>[I("重置")]),_:1},512),[[oe,!s.ifEdit]])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}};const xe={class:"row1"},ve={style:{"font-weight":"800","text-align":"center"}},he={style:{"text-align":"center"}},ke={class:"row3"},Ue={__name:"SeckillPage",setup(q){const u=K();le();let s=f(),r=f();ae(()=>{s.value,r.value=window.getComputedStyle(s.value).height}),window.onresize=()=>{let t=0,o=0;window.getComputedStyle(s.value).boxSizing=="border-box"&&(t=window.getComputedStyle(s.value).paddingTop?window.getComputedStyle(s.value).paddingTop.replace("px",""):0,o=window.getComputedStyle(s.value).paddingBottom?window.getComputedStyle(s.value).paddingBottom.replace("px",""):0),r.value=`${window.getComputedStyle(s.value).height.replace("px","")-t-o}px`,console.log(window.getComputedStyle(s.value).height,t,o,r.value)};const x=f(),p=f(!1),v=f(!1),m=f();let h=L({});const k=()=>{v.value=!0,m.value=!1},n=t=>{v.value=!0,m.value=!0,h.goodsId=t.row.goodsId,h.configRank=t.row.configRank,h.configName=t.row.configName,h.configId=t.row.configId},P=t=>{u.getSeckillDelete({ids:[t.row.configId]})},D=()=>{p.value&&x.value.getSelectionRows().length&&u.getSeckillDelete({ids:x.value.getSelectionRows().map(t=>t.configId)}),p.value=!p.value},b=C({get(){return u.currPage},set(t){u.currPage=t}}),_=C({get(){return u.pageSize},set(t){u.pageSize=t}});return F(async()=>{await u.getSeckillList(b.value,_.value)}),(t,o)=>{const w=G,g=ue,$=J,N=W,E=X,B=Y,U=pe,T=ce,j=A;return z(),H(M,null,[y("div",xe,[e(w,{onClick:k,type:"primary"},{default:l(()=>[I("新增")]),_:1}),e(w,{onClick:D,type:p.value?"danger":"default"},{default:l(()=>[I(S(p.value?"批量删除/取消批量操作":"批量操作"),1)]),_:1},8,["type"])]),y("div",{ref_key:"tableContainerRef",ref:s,class:"row2"},[e(T,{ref_key:"multipleTableRef",ref:x,stripe:"",border:"",height:i(r),style:{width:"100%","text-align":"center"},data:i(u).seckillList,"row-key":"configId"},{empty:l(()=>[e(U,{description:"加载中"})]),default:l(()=>[p.value?(z(),O(g,{key:0,type:"selection","min-width":"55px","reserve-selection":"",fixed:""})):ne("",!0),e(g,{type:"index","min-width":"70px",label:"序号",fixed:""}),e(g,{label:"ID","min-width":"70px",property:"configId"}),e(g,{label:"秒杀名称","min-width":"100px",property:"configName"}),e(g,{label:"商品展示","min-width":"320px"},{default:l(d=>[e(B,{"body-style":{padding:"10px"},style:{width:"300px",height:"140px",padding:"0",display:"flex","justify-content":"center"}},{default:l(()=>[e(E,{style:{flex:"1"}},{default:l(()=>[e(N,{span:8,style:{display:"flex","justify-content":"center","align-items":"center"}},{default:l(()=>{var c,V;return[e($,{src:`http://192.168.1.3:28019${(c=d.row.goodDetail)==null?void 0:c.goodsCoverImg}`,style:{width:"100px",height:"120px"},fit:"contain","hide-on-click-modal":!0,lazy:"","preview-src-list":[`http://192.168.1.3:28019${(V=d.row.goodDetail)==null?void 0:V.goodsCoverImg}`]},null,8,["src","preview-src-list"])]}),_:2},1024),e(N,{span:16,style:{display:"flex","flex-flow":"column","align-items":"center","font-size":"14px"}},{default:l(()=>[e(E,{gutter:10,style:{flex:"1","text-align":"center"}},{default:l(()=>{var c;return[y("span",ve,S((c=d.row.goodDetail)==null?void 0:c.goodsName),1)]}),_:2},1024),e(E,{style:{flex:"1","text-align":"center"}},{default:l(()=>{var c;return[y("span",he,S((c=d.row.goodDetail)==null?void 0:c.goodsIntro),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),e(g,{property:"configRank",label:"展示权重","min-width":"120px","show-overflow-tooltip":"",sortable:""}),e(g,{label:"操作","min-width":"150px",fixed:"right"},{default:l(d=>[e(w,{disabled:!!p.value,size:"default",onClick:c=>n(d)},{default:l(()=>[I("编辑")]),_:2},1032,["disabled","onClick"]),e(w,{disabled:!!p.value,size:"default",type:"danger",onClick:c=>P(d),style:{margin:"12px 0"}},{default:l(()=>[I("删除")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["height","data"])],512),y("div",ke,[e(j,{currentPage:i(b),"onUpdate:currentPage":o[0]||(o[0]=d=>R(b)?b.value=d:null),pageSize:i(_),"onUpdate:pageSize":o[1]||(o[1]=d=>R(_)?_.value=d:null),"page-sizes":[10,15,20],layout:"total, sizes, prev, pager, next, jumper",total:i(u).totalCount,"page-count":i(u).totalPage},null,8,["currentPage","pageSize","total","page-count"])]),e(ye,{drawer:v.value,"onUpdate:drawer":o[2]||(o[2]=d=>v.value=d),"onUpdata:drawer":o[3]||(o[3]=d=>v.value=d),ifEdit:m.value,seckill:i(h)},null,8,["drawer","ifEdit","seckill"])],64)}}};export{Ue as default};
